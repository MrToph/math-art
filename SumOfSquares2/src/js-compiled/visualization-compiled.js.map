{"version":3,"sources":["../js/visualization.jsx"],"names":[],"mappings":";;;;;;;;;;;;;;IAAM;;;AACJ,aADI,aACJ,CAAY,OAAZ,EAAqB;8BADjB,eACiB;;2EADjB,2BACiB;;AAEnB,cAAK,GAAL,GAAW,IAAX,CAFmB;AAGnB,cAAK,MAAL,GAAc,EAAC,KAAK,CAAC,CAAD,EAAI,OAAO,CAAC,CAAD,EAAI,QAAQ,CAAC,CAAD,EAAI,MAAM,CAAC,CAAD,EAArD,CAHmB;AAInB,cAAK,KAAL,GAAa,IAAb,CAJmB;AAKnB,cAAK,MAAL,GAAc,GAAd,CALmB;;AAOnB,cAAK,WAAL,GAAmB,CAAnB,CAPmB;AAQnB,cAAK,OAAL,GAAe,CAAf,CARmB;;AAUnB,cAAK,SAAL,GAAiB,CAAC,CAAD,EAAG,CAAH,CAAjB,CAVmB;AAWnB,cAAK,KAAL,GAAa,CAAb,CAXmB;;AAanB,YAAI,YAAY,MAAK,KAAL,GAAa,MAAK,MAAL,CAAY,IAAZ,GAAmB,MAAK,MAAL,CAAY,KAAZ,CAb7B;AAcnB,YAAI,aAAa,MAAK,MAAL,GAAc,MAAK,MAAL,CAAY,GAAZ,GAAkB,MAAK,MAAL,CAAY,MAAZ,CAd9B;AAenB,YAAI,MAAM,GAAG,MAAH,CAAU,OAAV,EAAmB,MAAnB,CAA0B,KAA1B,EACL,IADK,CACA,SADA,EACW,SAAS,SAAT,GAAqB,GAArB,GAA2B,UAA3B,CADX,CAEL,MAFK,CAEE,GAFF,EAGL,IAHK,CAGA,WAHA,EAGa,eAAe,MAAK,MAAL,CAAY,IAAZ,GAAmB,GAAlC,GAAwC,MAAK,MAAL,CAAY,KAAZ,GAAoB,GAA5D,CAHnB,CAfe;;AAoBnB,cAAK,GAAL,GAAW,GAAX,CApBmB;;AAsBnB,YAAI,OAAO,IAAI,MAAJ,CAAW,MAAX,EACE,IADF,CACO,OADP,EACgB,cADhB,EAEE,IAFF,CAEO,GAFP,EAEY,CAAC,MAAK,MAAL,CAAY,IAAZ,CAFb,CAGE,IAHF,CAGO,GAHP,EAGY,CAAC,MAAK,MAAL,CAAY,GAAZ,CAHb,CAIE,IAJF,CAIO,OAJP,EAIgB,SAJhB,EAKE,IALF,CAKO,QALP,EAKiB,UALjB,CAAP,CAtBe;;AA6BnB,YAAI,YAAY,IAAI,MAAJ,CAAW,GAAX,EACG,IADH,CACQ,WADR,EACqB,eAAe,MAAK,SAAL,CAAe,CAAf,CAAf,GAAmC,GAAnC,GAAyC,MAAK,SAAL,CAAe,CAAf,CAAzC,GAA6D,UAA7D,GAA0E,MAAK,KAAL,GAAa,GAAvF,CADjC,CA7Be;AA+BnB,cAAK,SAAL,GAAiB,SAAjB,CA/BmB;AAgCnB,cAAK,SAAL,GAAiB,UAAU,MAAV,CAAiB,OAAjB,CAAjB,CAhCmB;AAiCnB,cAAK,KAAL,GAAa,UAAU,MAAV,CAAiB,OAAjB,CAAb;;;AAjCmB,aAoCnB,CAAK,MAAL,GAAc,CAAC,SAAD,EAAY,SAAZ,EAAuB,SAAvB,EAAkC,SAAlC,EAA6C,SAA7C,EAAwD,SAAxD,CAAd,CApCmB;AAqCnB,cAAK,OAAL,GAAe,GAAf,CArCmB;AAsCnB,cAAK,QAAL,GAAgB,MAAK,OAAL,CAtCG;AAuCnB,cAAK,MAAL,GAAc,IAAI,MAAK,OAAL,CAvCC;AAwCnB,cAAK,QAAL,GAAgB,CAAhB,CAxCmB;;AA0CnB,cAAK,MAAL,CAAY,CAAZ,EA1CmB;;KAArB;;;;;;iBADI;;mCAgDK,MAAM;;;AACb,oBAAO,IAAP;AACI;AAAQ;AACJ,6BAAK,gBAAL,GAAwB,EAAxB,CADI;AAEJ,6BAAK,gBAAL,CAAsB,IAAtB,CAA2B,KAAK,kBAAL,CAAwB,gBAAW;;;gCAAT,aAAS;gCAAP,aAAO;;AAC1D,gCAAI,QAAQ,CAAR,CADsD;AAE1D,gCAAI,OAAO,IAAE,CAAF,CAF+C;AAG1D,gCAAG,MAAM,OAAK,QAAL,GAAgB,CAAhB,EAAkB;AACvB,uCAAO,IAAI,CAAJ,GAAQ,GAAR,GAAmB,GAAnB,CADgB;6BAA3B,MAGK,IAAG,MAAM,OAAK,QAAL,GAAgB,CAAhB,EACV,OAAO,GAAP,CADC;AAEL,mCAAO,CAAC,IAAD,EAAO,KAAP,CAAP,CAR0D;yBAAX,CAAnD,EAFI;AAYJ,6BAAK,gBAAL,CAAsB,IAAtB,CAA2B,KAAK,kBAAL,CAAwB,iBAAW;;;gCAAT,aAAS;gCAAP,aAAO;;AAC1D,gCAAI,QAAQ,OAAK,QAAL,GAAgB,CAAhB,IAAqB,IAAE,CAAF,CAArB,CAD8C;AAE1D,gCAAI,OAAO,OAAK,QAAL,IAAiB,IAAE,CAAF,CAAjB,CAF+C;AAG1D,gCAAG,QAAQ,OAAK,QAAL,GAAgB,CAAhB,EAAkB;AACzB,wCAAO,CAAP;AACI,yCAAK,CAAL;AACI,+CAAO,GAAP,CADJ;AAEI,8CAFJ;AADJ,yCAIS,CAAL;AACI,+CAAO,GAAP,CADJ;AAEI,8CAFJ;AAJJ;AAQQ,+CAAO,GAAP,CADJ;AAPJ,iCADyB;6BAA7B,MAYK,IAAI,QAAQ,OAAK,QAAL,EACb,OAAO,GAAP,CADC;AAEL,mCAAO,CAAC,IAAD,EAAO,KAAP,CAAP,CAjB0D;yBAAX,CAAnD,EAZI;AA+BJ,6BAAK,gBAAL,CAAsB,IAAtB,CAA2B,KAAK,kBAAL,CAAwB,iBAAW;;;gCAAT,aAAS;gCAAP,aAAO;;AAC1D,gCAAI,QAAQ,OAAK,QAAL,GAAgB,CAAhB,GAAoB,CAApB,CAD8C;AAE1D,gCAAI,OAAO,OAAK,QAAL,GAAgB,CAAhB,CAF+C;AAG1D,gCAAG,QAAQ,OAAK,QAAL,GAAgB,CAAhB,EAAkB;AACzB,wCAAO,CAAP;AACI,yCAAK,CAAL;AACI,+CAAO,GAAP,CADJ;AAEI,8CAFJ;AADJ;AAKQ,+CAAO,GAAP,CADJ;AAJJ,iCADyB;6BAA7B,MASK,IAAI,QAAQ,OAAK,QAAL,EACb,OAAO,GAAP,CADC;AAEL,mCAAO,CAAC,IAAD,EAAO,KAAP,CAAP,CAd0D;yBAAX,CAAnD,EA/BI;AA+CJ,6BAAK,gBAAL,CAAsB,IAAtB,CAA2B,KAAK,kBAAL,CAAwB;;;gCAAE;gCAAE;mCAAO,CAAC,MAAD,EAAS,OAAK,QAAL;yBAApB,CAAnD;;;AA/CI,4BAkDA,gBAAgB,KAAK,QAAL,GAAgB,KAAK,OAAL,CAlDhC;AAmDJ,6BAAK,WAAL,GAAmB,CAAC,EAAC,GAAG,gBAAgB,MAAK,KAAK,MAAL,EAAa,GAAG,MAAK,aAAL,EAAoB,SAAS,GAAT,EAAc,UAAU,MAAV,EAA5E,EACC,EAAC,GAAG,IAAI,aAAJ,GAAoB,MAAM,KAAK,MAAL,EAAa,GAAG,MAAK,aAAL,EAAoB,SAAS,GAAT,EAAc,UAAU,MAAV,EADjF,EAEC,EAAC,GAAG,IAAI,aAAJ,GAAoB,MAAK,KAAK,MAAL,EAAa,GAAG,MAAK,aAAL,EAAoB,SAAS,GAAT,EAAc,UAAU,MAAV,EAFhF,CAAnB,CAnDI;AAsDR,8BAtDQ;qBAAR;AADJ,aADa;;;;;;;;2CA+DE,UAAS;AACxB,gBAAI,MAAM,EAAN,CADoB;AAExB,iBAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,KAAK,QAAL,EAAe,GAAlC,EAAsC;AAClC,qBAAI,IAAI,IAAI,CAAJ,EAAO,KAAK,CAAL,EAAQ,GAAvB,EAA2B;AACvB,wBAAI,OAAO,IAAI,KAAK,OAAL,CADQ;AAEvB,wBAAI,OAAO,IAAI,KAAK,QAAL,CAFQ;;oCAGH,SAAS,CAAC,CAAD,EAAG,CAAH,CAAT,EAHG;;;;wBAGlB,qBAHkB;wBAGZ,sBAHY;;AAIvB,wBAAI,IAAJ,CAAS,EAAC,IAAI,CAAC,CAAD,EAAG,CAAH,CAAJ,EAAW,OAAO,KAAK,OAAL,EAAc,QAAQ,KAAK,QAAL,EAAe,SAAS,IAAT,EAAe,OAAO,KAAP;AACpE,2BAAG,IAAH,EAAS,GAAG,IAAH,EADrB,EAJuB;iBAA3B;aADJ;AASA,mBAAO,GAAP,CAXwB;;;;iCAcG;;;gBAAxB,6DAAO,KAAK,WAAL,gBAAiB;;AAC3B,iBAAK,WAAL,GAAmB,IAAnB,CAD2B;;AAG3B,iBAAK,UAAL,CAAgB,IAAhB,EAH2B;AAI3B,iBAAK,SAAL,CAAe,SAAf,CAAyB,4EAAzB,EAAuG,MAAvG,GAJ2B;AAK3B,iBAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,CAAJ,EAAO,GAAtB,EAA0B;AACtB,qBAAK,cAAL,CAAoB,CAApB,EADsB;aAA1B;AAGA,iBAAK,cAAL,GAR2B;AAS3B,gBAAG,SAAS,CAAT,EAAW;;AACV,wBAAI,kBAAkB,IAAlB;AACJ,wBAAI,YAAY,OAAK,SAAL,CAAe,SAAf,CAAyB,4EAAzB,EAAuG,MAAvG,CAA8G,aAA9G,CAAZ;AACJ,8BAAU,KAAV,CAAgB,SAAhB,EAA2B,GAA3B,EAAgC,UAAhC,GAA6C,IAA7C,CAAkD,QAAlD,EACG,QADH,CACY,eADZ,EAC6B,KAD7B,CACmC;+BAAK,EAAE,KAAF,GAAU,eAAV;qBAAL,CADnC,CACmE,KADnE,CACyE,SADzE,EACoF,GADpF,EAEG,IAFH,CAEQ,MAFR,EAEgB,YAAM;AAAE,gCAAQ,SAAR,GAAF;qBAAN,CAFhB;qBAHU;aAAd;;;;yCASY;AACZ,gBAAI,QAAQ,KAAK,KAAL,CAAW,SAAX,CAAqB,UAArB,EAAiC,IAAjC,CAAsC,KAAK,WAAL,CAAtC,CAAwD,KAAxD,GAAgE,MAAhE,CAAuE,MAAvE,EAA+E,IAA/E,CAAoF,OAApF,EAA6F,SAA7F,CAAR,CADQ;AAEZ,oBAAQ,KAAK,KAAL,CAAW,SAAX,CAAqB,UAArB,EACa,IADb,CACmB;uBAAK,EAAE,OAAF;aAAL,CADnB,CAEa,IAFb,CAEkB,aAFlB,EAEiC,QAFjC;aAGa,IAHb,CAGkB,mBAHlB,EAGuC,QAHvC;aAIa,IAJb,CAIkB,WAJlB,EAI+B;uBAAK,eAAgB,EAAE,CAAF,GAAO,GAAvB,GAA8B,MAAM,EAAE,CAAF,GAAO,GAA3C;aAAL,CAJ/B,CAKa,IALb,CAKkB,WALlB,EAK+B;uBAAK,EAAE,QAAF;aAAL,CALvC,CAFY;;;;uCAUC,OAAM;;;AACnB,gBAAI,gBAAgB,KAAK,QAAL,GAAgB,KAAK,OAAL,CADjB;AAEnB,gBAAI,UAAU,KAAK,SAAL,CAAe,SAAf,CAAyB,qBAAqB,KAArB,CAAzB,CAAqD,IAArD,CAA0D,KAAK,gBAAL,CAAsB,KAAtB,CAA1D,CAAV,CAFe;AAGnB,gBAAI,mBAAmB,QAAQ,KAAR,GAAgB,MAAhB,CAAuB,GAAvB,EAA4B,IAA5B,CAAiC,OAAjC,EAA0C,oBAAoB,KAApB,CAA7D,CAHe;AAInB,6BAAiB,MAAjB,CAAwB,MAAxB,EAAgC,IAAhC,CAAqC,OAArC,EAA8C,QAA9C,EAJmB;AAKnB,6BAAiB,MAAjB,CAAwB,MAAxB,EAAgC,IAAhC,CAAqC,OAArC,EAA8C,YAA9C;;AALmB,mBAOnB,GAAU,KAAK,SAAL,CAAe,SAAf,CAAyB,qBAAqB,KAArB,CAAnC,CAPmB;AAQnB,oBAAQ,IAAR,CAAa,WAAb,EAA0B,eAAgB,SAAS,gBAAgB,KAAK,MAAL,CAAzB,GAAyC,MAAzD,CAA1B,CARmB;AASnB,oBAAQ,SAAR,CAAkB,SAAlB,EAA6B,IAA7B,CAAkC;uBAAK,CAAC,CAAD;aAAL;AAAlC,aACa,IADb,CACkB,OADlB,EAC2B;uBAAK,EAAE,KAAF;aAAL,CAD3B,CAEa,IAFb,CAEkB,QAFlB,EAE4B;uBAAK,EAAE,MAAF;aAAL,CAF5B,CAGa,IAHb,CAGkB,GAHlB,EAGuB;uBAAK,EAAE,CAAF;aAAL,CAHvB,CAIa,IAJb,CAIkB,GAJlB,EAIuB;uBAAK,EAAE,CAAF;aAAL,CAJvB,CATmB;;AAenB,gBAAI,WAAW,UAAU,CAAV,GAAc,MAAd,GAAuB,MAAvB,CAfI;AAgBnB,oBAAQ,SAAR,CAAkB,aAAlB,EAAiC,IAAjC,CAAsC;uBAAK,CAAC,CAAD;aAAL;AAAtC,aACqB,IADrB,CAC2B;uBAAK,EAAE,OAAF;aAAL,CAD3B,CAEqB,IAFrB,CAE0B,aAF1B,EAEyC,QAFzC;aAGqB,IAHrB,CAG0B,mBAH1B,EAG+C,QAH/C;aAIqB,IAJrB,CAI0B,WAJ1B,EAIuC;uBAAK,gBAAgB,EAAE,CAAF,GAAM,MAAM,EAAE,KAAF,CAA5B,GAAuC,GAAvC,IAA8C,EAAE,CAAF,GAAM,OAAO,EAAE,MAAF,CAA3D,GAAuE,GAAvE;aAAL,CAJvC,CAKqB,IALrB,CAK0B,WAL1B,EAKuC,QALvC,EAMqB,KANrB,CAM2B,SAN3B,EAMsC,GANtC,EAOqB,IAPrB,CAO0B,MAP1B,EAOkC;uBAAK,OAAK,MAAL,CAAY,EAAE,KAAF;aAAjB,CAPlC,CAhBmB;;;;+BA0Bd,SAAQ;;AAEb,iBAAK,SAAL,CAAe,SAAf,CAAyB,aAAzB,EAAwC,UAAxC,GAFa;AAGb,8CAtLE,qDAsLkB,QAApB,CAHa;;;;WAnLX;EAAsB;;AA0L5B,SAAS,MAAT,CAAiB,UAAjB,EAA6B,QAA7B,EAAuC;AACnC,QAAI,CAAJ,CADmC;;AAGnC,QAAI,WAAW,KAAX,EAAJ,EAAwB;AACpB,mBADoB;KAAxB,MAGK;AACD,YAAI,WAAW,IAAX,EAAJ,CADC;AAED,mBAAW,IAAX,CAAgB,KAAhB,EAAuB,YAAM;AACzB,gBADyB;AAEzB,gBAAI,MAAM,CAAN,EAAS;AACT,2BADS;aAAb;SAFmB,CAAvB,CAFC;KAHL;CAHJ","file":"visualization-compiled.js","sourcesContent":["class Visualization extends ISteppable{\r\n  constructor(element) {\r\n    super();\r\n    this.svg = null;\r\n    this.margin = {top: -0, right: -0, bottom: -0, left: -0};\r\n    this.width = 2600;\r\n    this.height = 500;\r\n\r\n    this.currentStep = 0;\r\n    this.maxStep = 1;\r\n\r\n    this.translate = [0,0];\r\n    this.scale = 1;\r\n\r\n    let realWidth = this.width + this.margin.left + this.margin.right;\r\n    let realHeight = this.height + this.margin.top + this.margin.bottom;\r\n    let svg = d3.select(element).append(\"svg\")\r\n        .attr(\"viewBox\", \"0 0 \" + realWidth + \" \" + realHeight)\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + this.margin.left + \",\" + this.margin.right + \")\")\r\n\r\n    this.svg = svg;\r\n\r\n    let rect = svg.append(\"rect\")\r\n                .attr(\"class\", \"svgOuterRect\")\r\n                .attr(\"x\", -this.margin.left)\r\n                .attr(\"y\", -this.margin.top)\r\n                .attr(\"width\", realWidth)\r\n                .attr(\"height\", realHeight);\r\n\r\n    let container = svg.append(\"g\")\r\n                      .attr(\"transform\", \"translate(\" + this.translate[0] + \",\" + this.translate[1] + \"),scale(\" + this.scale + \")\");\r\n    this.container = container;\r\n    this.triangles = container.append('svg:g');\r\n    this.texts = container.append('svg:g');\r\n\r\n    // Constants\r\n    this.colors = [\"#ff3232\", \"#32CD32\", \"#3232ff\", \"#000000\", \"#ffa500\", \"#8A2BE2\"];\r\n    this.trWidth = 100;\r\n    this.trHeight = this.trWidth;\r\n    this.margin = 2 * this.trWidth;\r\n    this.numCells = 5;\r\n\r\n    this.redraw(0);\r\n  }\r\n  \r\n// http://www.fileformat.info/info/unicode/category/Sm/list.htm\r\n// \\dots = \\u2026   \\vdots = \\u22ee \\ddots = \\u22f0 (/) \\u22f1 (\\)\r\ncreateData(step) {\r\n    switch(step){\r\n        default:{\r\n            this.triangleDrawData = [];\r\n            this.triangleDrawData.push(this.createTriangleData(([i,j]) => {\r\n                let layer = i;\r\n                let text = i+1;\r\n                if(i === this.numCells - 2){\r\n                    text = j < 3 ? \"\\u22ee\" : \"\\u22f1\";\r\n                }\r\n                else if(i === this.numCells - 1)\r\n                    text = \"n\";\r\n                return [text, layer];\r\n            }));\r\n            this.triangleDrawData.push(this.createTriangleData(([i,j]) => {\r\n                let layer = this.numCells - 1 - (i-j);\r\n                let text = this.numCells - (i-j);\r\n                if(text == this.numCells - 1){\r\n                    switch(j){\r\n                        case 0:\r\n                            text = \"\\u22ee\";\r\n                            break;\r\n                        case 3:\r\n                            text = \"\\u2026\";\r\n                            break;\r\n                        default:\r\n                            text = \"\\u22f0\";\r\n                    }\r\n                }\r\n                else if (text == this.numCells)\r\n                    text = \"n\";\r\n                return [text, layer];\r\n            }));\r\n            this.triangleDrawData.push(this.createTriangleData(([i,j]) => {\r\n                let layer = this.numCells - 1 - j;\r\n                let text = this.numCells - j;\r\n                if(text == this.numCells - 1){\r\n                    switch(i){\r\n                        case 1:\r\n                            text = \"\\u22f1\";\r\n                            break;\r\n                        default:\r\n                            text = \"\\u2026\";\r\n                    }\r\n                }\r\n                else if (text == this.numCells)\r\n                    text = \"n\";\r\n                return [text, layer];\r\n            }));\r\n            this.triangleDrawData.push(this.createTriangleData(([i,j]) => [\"2n+1\", this.numCells]));\r\n\r\n            // +, +, = between the triangles\r\n            let triangleWidth = this.numCells * this.trWidth;\r\n            this.operandData = [{x: triangleWidth + 0.5* this.margin, y: 0.5* triangleWidth, caption: \"+\", fontSize: \"96pt\"},\r\n                                {x: 2 * triangleWidth + 1.5 * this.margin, y: 0.5* triangleWidth, caption: \"+\", fontSize: \"96pt\"},\r\n                                {x: 3 * triangleWidth + 2.5* this.margin, y: 0.5* triangleWidth, caption: \"=\", fontSize: \"96pt\"}];\r\n        break;\r\n        }\r\n    }\r\n}\r\n\r\n// idToText is a function that maps (row, column) to (text, layer) where layer is from 0 .. this.numCells [-1]\r\n// layer represents the structural layout of the triangle (layer 0: is where the 1's are, layer 1: where the 2's ... layer numCells - 1: where text = n)\r\ncreateTriangleData(idToText){\r\n    let arr = [];\r\n    for(let i = 0; i < this.numCells; i++){\r\n        for(let j = 0; j <= i; j++){\r\n            let xPos = j * this.trWidth;\r\n            let yPos = i * this.trHeight;\r\n            let [text, layer] = idToText([i,j]);\r\n            arr.push({id: [i,j], width: this.trWidth, height: this.trHeight, caption: text, layer: layer,\r\n                        x: xPos, y: yPos});\r\n        }\r\n    }\r\n    return arr;\r\n}\r\n\r\nredraw(step = this.currentStep){\r\n    this.currentStep = step;\r\n\r\n    this.createData(step);\r\n    this.triangles.selectAll('.squareContainer0, .squareContainer1, .squareContainer2, .squareContainer3').remove();\r\n    for(let i = 0; i < 4; i++){\r\n        this.createTriangle(i);\r\n    }\r\n    this.createOperands();\r\n    if(step === 0){\r\n        let opacityDuration = 2250;\r\n        let triangles = this.triangles.selectAll('.squareContainer0, .squareContainer1, .squareContainer2, .squareContainer3').select('.squareText');\r\n        triangles.style(\"opacity\", 0.0).transition().ease('linear')\r\n          .duration(opacityDuration).delay(d => d.layer * opacityDuration).style(\"opacity\", 1.0)\r\n          .call(endAll, () => { stepper.onForward() });\r\n    }\r\n}\r\n\r\ncreateOperands(){\r\n    let texts = this.texts.selectAll(\".operand\").data(this.operandData).enter().append('text').attr('class', 'operand');\r\n    texts = this.texts.selectAll(\".operand\")\r\n                        .text( d => d.caption)\r\n                        .attr('text-anchor', \"middle\")  // horizontal alignment\r\n                        .attr('dominant-baseline', \"middle\")  // vertical alignment\r\n                        .attr('transform', d => \"translate(\" + (d.x) + \",\" + (1.1 * d.y) + \")\")\r\n                        .attr(\"font-size\", d => d.fontSize);\r\n}\r\n\r\n  createTriangle(index){\r\n    let triangleWidth = this.numCells * this.trWidth;\r\n    let squares = this.triangles.selectAll(\".squareContainer\" + index).data(this.triangleDrawData[index]);\r\n    let squaresContainer = squares.enter().append('g').attr('class', 'squareContainer' + index);\r\n    squaresContainer.append('rect').attr('class', 'square');\r\n    squaresContainer.append('text').attr('class', 'squareText');\r\n    // update\r\n    squares = this.triangles.selectAll(\".squareContainer\" + index);\r\n    squares.attr('transform', 'translate(' + (index * (triangleWidth + this.margin)) + ', 0)')\r\n    squares.selectAll(\".square\").data(d => [d]) // descend parent data into children, d comes from parent selection (need to select .squareContainer because of that)\r\n                .attr('width', d => d.width)\r\n                .attr('height', d => d.height)\r\n                .attr('x', d => d.x )\r\n                .attr('y', d => d.y);\r\n\r\n    let fontSize = index === 3 ? \"23pt\" : \"36pt\";\r\n    squares.selectAll('.squareText').data(d => [d]) // descend parent data into children\r\n                        .text( d => d.caption)\r\n                        .attr('text-anchor', \"middle\")  // horizontal alignment\r\n                        .attr('dominant-baseline', \"middle\")  // vertical alignment\r\n                        .attr('transform', d => \"translate(\" + (d.x + 0.5 * d.width) + \",\" + (d.y + 0.55 * d.height) + \")\")\r\n                        .attr(\"font-size\", fontSize)\r\n                        .style(\"opacity\", 1.0)\r\n                        .attr(\"fill\", d => this.colors[d.layer]);\r\n  }\r\n\r\n  onStep(forward){\r\n    // always stop all transitions\r\n    this.container.selectAll('.squareText').transition();\r\n    return super.onStep(forward);\r\n  }\r\n}\r\n\r\nfunction endAll (transition, callback) {\r\n    var n;\r\n\r\n    if (transition.empty()) {\r\n        callback();\r\n    }\r\n    else {\r\n        n = transition.size();\r\n        transition.each(\"end\", () => {\r\n            n--;\r\n            if (n === 0) {\r\n                callback();\r\n            }\r\n        });\r\n    }\r\n}"]}